/*!
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("prop-types"),require("@ckeditor/ckeditor5-watchdog")):"function"==typeof define&&define.amd?define(["react","prop-types","@ckeditor/ckeditor5-watchdog"],e):"object"==typeof exports?exports.CKEditor=e(require("react"),require("prop-types"),require("@ckeditor/ckeditor5-watchdog")):t.CKEditor=e(t.react,t["prop-types"],t["@ckeditor/ckeditor5-watchdog"])}(self,((t,e,o)=>(()=>{"use strict";var r={546:t=>{t.exports=o},949:t=>{t.exports=e},155:e=>{e.exports=t}},i={};function n(t){var e=i[t];if(void 0!==e)return e.exports;var o=i[t]={exports:{}};return r[t](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{n.r(a),n.d(a,{CKEditor:()=>u,CKEditorContext:()=>c,useMultiRootEditor:()=>f});var t=n(155),e=n.n(t),o=n(949),r=n.n(o);const i=new Array(256).fill("").map(((t,e)=>("0"+e.toString(16)).slice(-2)));var s=n(546);const d=e().createContext("contextWatchdog");class c extends e().Component{constructor(t,e){super(t,e),this.contextWatchdog=null,this.props.isLayoutReady&&this._initializeContextWatchdog(this.props.config)}shouldComponentUpdate(t){return this._shouldComponentUpdate(t)}async _shouldComponentUpdate(t){return t.id!==this.props.id&&(this.contextWatchdog&&await this.contextWatchdog.destroy(),await this._initializeContextWatchdog(t.config)),t.isLayoutReady&&!this.contextWatchdog?(await this._initializeContextWatchdog(t.config),!0):this.props.children!==t.children}render(){return e().createElement(d.Provider,{value:this.contextWatchdog},this.props.children)}componentWillUnmount(){this._destroyContext()}async _initializeContextWatchdog(t){this.contextWatchdog=new s.ContextWatchdog(this.props.context,this.props.watchdogConfig),this.contextWatchdog.on("error",((t,e)=>{this.props.onError(e.error,{phase:"runtime",willContextRestart:e.causesRestart})})),this.contextWatchdog.on("stateChange",(()=>{"ready"===this.contextWatchdog.state&&this.props.onReady&&this.props.onReady(this.contextWatchdog.context)})),await this.contextWatchdog.create(t).catch((t=>{this.props.onError(t,{phase:"initialization",willContextRestart:!1})}))}async _destroyContext(){this.contextWatchdog&&(await this.contextWatchdog.destroy(),this.contextWatchdog=null)}}c.defaultProps={isLayoutReady:!0,onError:(t,e)=>console.error(t,e)},c.propTypes={id:r().string,isLayoutReady:r().bool,context:r().func,watchdogConfig:r().object,config:r().object,onReady:r().func,onError:r().func};const h="Lock from React integration (@ckeditor/ckeditor5-react)";class u extends e().Component{constructor(t){super(t),this.editorDestructionInProgress=null,this.domContainer=e().createRef(),this.watchdog=null;const{CKEDITOR_VERSION:o}=window;if(o){const[t]=o.split(".").map(Number);t<37&&console.warn("The <CKEditor> component requires using CKEditor 5 in version 37 or higher.")}else console.warn('Cannot find the "CKEDITOR_VERSION" in the "window" scope.')}get editor(){return this.props.disableWatchdog?this.instance:this.watchdog?this.watchdog.editor:null}shouldComponentUpdate(t){return!!this.editor&&(t.id!==this.props.id||(t.disableWatchdog!==this.props.disableWatchdog||(this._shouldUpdateEditor(t)&&this.editor.data.set(t.data),"disabled"in t&&(t.disabled?this.editor.enableReadOnlyMode(h):this.editor.disableReadOnlyMode(h)),!1)))}async componentDidMount(){await this._initializeEditor()}async componentDidUpdate(){await this._destroyEditor(),await this._initializeEditor()}async componentWillUnmount(){await this._destroyEditor()}render(){return e().createElement("div",{ref:this.domContainer})}async _initializeEditor(){await this.editorDestructionInProgress,this.props.disableWatchdog?this.instance=await this._createEditor(this.domContainer.current,this._getConfig()):this.watchdog||(this.context instanceof s.ContextWatchdog?this.watchdog=new l(this.context):this.watchdog=new u._EditorWatchdog(this.props.editor,this.props.watchdogConfig),this.watchdog.setCreator(((t,e)=>this._createEditor(t,e))),this.watchdog.on("error",((t,{error:e,causesRestart:o})=>{(this.props.onError||console.error)(e,{phase:"runtime",willEditorRestart:o})})),await this.watchdog.create(this.domContainer.current,this._getConfig()).catch((t=>{(this.props.onError||console.error)(t,{phase:"initialization",willEditorRestart:!1})})))}_createEditor(t,e){return this.props.editor.create(t,e).then((t=>{"disabled"in this.props&&this.props.disabled&&t.enableReadOnlyMode(h);const e=t.model.document,o=t.editing.view.document;return e.on("change:data",(e=>{this.props.onChange&&this.props.onChange(e,t)})),o.on("focus",(e=>{this.props.onFocus&&this.props.onFocus(e,t)})),o.on("blur",(e=>{this.props.onBlur&&this.props.onBlur(e,t)})),setTimeout((()=>{this.props.onReady&&this.props.onReady(t)})),t}))}async _destroyEditor(){this.editorDestructionInProgress=new Promise((t=>{setTimeout((async()=>this.watchdog?(await this.watchdog.destroy(),this.watchdog=null,t()):this.instance?(await this.instance.destroy(),this.instance=null,t()):void t()))}))}_shouldUpdateEditor(t){return this.props.data!==t.data&&this.editor.data.get()!==t.data}_getConfig(){const t=this.props.config||{};return this.props.data&&t.initialData&&console.warn("Editor data should be provided either using `config.initialData` or `content` property. The config value takes precedence over `content` property and will be used when both are specified."),{...t,initialData:t.initialData||this.props.data||""}}}u.contextType=d,u.propTypes={editor:r().func.isRequired,data:r().string,config:r().object,disableWatchdog:r().bool,watchdogConfig:r().object,onChange:r().func,onReady:r().func,onFocus:r().func,onBlur:r().func,onError:r().func,disabled:r().bool,id:r().any},u._EditorWatchdog=s.EditorWatchdog;class l{constructor(t){this._contextWatchdog=t,this._id=function(){const t=4294967296*Math.random()>>>0,e=4294967296*Math.random()>>>0,o=4294967296*Math.random()>>>0,r=4294967296*Math.random()>>>0;return"e"+i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255]+i[255&e]+i[e>>8&255]+i[e>>16&255]+i[e>>24&255]+i[255&o]+i[o>>8&255]+i[o>>16&255]+i[o>>24&255]+i[255&r]+i[r>>8&255]+i[r>>16&255]+i[r>>24&255]}()}setCreator(t){this._creator=t}create(t,e){return this._contextWatchdog.add({sourceElementOrData:t,config:e,creator:this._creator,id:this._id,type:"editor"})}on(t,e){this._contextWatchdog.on("itemError",((t,{itemId:o,error:r})=>{o===this._id&&e(null,{error:r,causesRestart:void 0})}))}destroy(){return"ready"===this._contextWatchdog.state?this._contextWatchdog.remove(this._id):Promise.resolve()}get editor(){return this._contextWatchdog.getItem(this._id)}}const p="Lock from React integration (@ckeditor/ckeditor5-react)",g=({editor:o})=>{const r=(0,t.useRef)(null);return(0,t.useEffect)((()=>{const t=r.current;if(!o||!t)return;const e=o.ui.view.toolbar.element;return t&&t.appendChild(e),()=>{t&&t.removeChild(e)}}),[o&&o.id]),e().createElement("div",{ref:r})},f=o=>{const r=(0,t.useRef)(null),i=(0,t.useRef)(null),n=(0,t.useContext)(d),[a,c]=(0,t.useState)(null),[h,u]=(0,t.useState)(o.data),[f,y]=(0,t.useState)(o.rootsAttributes||{}),[m,b]=(0,t.useState)([]),w=(0,t.useRef)(!0);(0,t.useEffect)((()=>((async()=>{await i.current,!1!==o.isLayoutReady&&await v()})(),()=>{x().then((()=>{i.current=null}))})),[o.isLayoutReady]),(0,t.useEffect)((()=>{a&&(o.disabled?a.enableReadOnlyMode(p):a.disableReadOnlyMode(p))}),[o.disabled]),(0,t.useEffect)((()=>{if(a&&!i.current){const t=a.getFullData();u({...t}),y({...a.getRootsAttributes()}),b([...Object.keys(t).map((t=>C(a,t)))])}}),[a&&a.id]);const E=()=>{const t=o.config||{};return o.data&&t.initialData&&console.warn("Editor data should be provided either using `config.initialData` or `data` property. The config value takes precedence over `data` property and will be used when both are specified."),{...t,rootsAttributes:f}},C=(t,o)=>e().createElement("div",{id:o,key:o,ref:e=>{if(e){const r=t.ui.view.createEditable(o,e);t.ui.addEditable(r),t.editing.view.forceRender()}}}),R=(t,e)=>o.editor.create(t,e).then((t=>{o.disabled&&o.disabled&&t.enableReadOnlyMode(p);const e=t.model.document,r=t.editing.view.document;return e.on("change:data",(e=>((t,e)=>{const r=t.model.document;if(!o.disableTwoWayDataBinding){const e={},o={};r.differ.getChanges().forEach((o=>{let r;if(r="insert"==o.type||"remove"==o.type?o.position.root:o.range.root,!r.isAttached())return;const{rootName:i}=r;e[i]=t.getData({rootName:i})})),r.differ.getChangedRoots().forEach((r=>{if(r.state)return void(void 0!==e[r.name]&&delete e[r.name]);const i=r.name;o[i]=t.getRootAttributes(i)})),Object.keys(e).length&&u((t=>({...t,...e}))),Object.keys(o).length&&y((t=>({...t,...o})))}o.onChange&&o.onChange(e,t)})(t,e))),t.on("addRoot",((e,r)=>((t,e,r)=>{const i=r.rootName,n=C(t,i);o.disableTwoWayDataBinding||(u((e=>({...e,[i]:t.getData({rootName:i})}))),y((e=>({...e,[i]:t.getRootAttributes(i)})))),b((t=>[...t,n]))})(t,0,r))),t.on("detachRoot",((e,r)=>((t,e,r)=>{const i=r.rootName;b((t=>t.filter((t=>t.props.id!==i)))),o.disableTwoWayDataBinding||(u((t=>{const{[i]:e,...o}=t;return{...o}})),y((t=>{const{[i]:e,...o}=t;return{...o}}))),t.detachEditable(r)})(t,0,r))),r.on("focus",(e=>{o.onFocus&&o.onFocus(e,t)})),r.on("blur",(e=>{o.onBlur&&o.onBlur(e,t)})),c(t),o.onReady&&o.onReady(t),t})),x=async()=>{c(null),u({}),y({}),b([]),i.current=new Promise((t=>{setTimeout((async()=>r.current?(await r.current.destroy(),r.current=null,t()):a?(await a.destroy(),t()):void t()))}))},v=async()=>{if(o.disableWatchdog)return void await R(o.data,E());if(r.current)return;n instanceof s.ContextWatchdog?r.current=new l(n):r.current=new s.EditorWatchdog(o.editor,o.watchdogConfig);const t=r.current;t.setCreator(((t,e)=>R(t,e))),t.on("error",((t,{error:e,causesRestart:r})=>{(o.onError||console.error)(e,{phase:"runtime",willEditorRestart:r})})),await t.create(h,E()).catch((t=>{(o.onError||console.error)(t,{phase:"initialization",willEditorRestart:!1})}))};(0,t.useEffect)((()=>{if(a&&w.current){w.current=!1;const t=Object.keys(h),e=Object.keys(f);if(!t.every((t=>e.includes(t))))throw new Error("`data` and `attributes` objects must have the same keys (roots).");const o=a.getFullData(),r=a.getRootsAttributes(),{addedKeys:i,removedKeys:n}=W(o,h||{}),s=t.some((t=>void 0!==o[t]&&JSON.stringify(o[t])!==JSON.stringify(h[t]))),d=e.filter((t=>JSON.stringify(r[t])!==JSON.stringify(f[t])));a.model.change((t=>{_(i),k(n),s&&O(),d.length&&D(t,d)}))}}),[h,f]);const W=(t,e)=>{const o=Object.keys(t),r=Object.keys(e);return{addedKeys:r.filter((t=>!o.includes(t))),removedKeys:o.filter((t=>!r.includes(t)))}},_=t=>{t.forEach((t=>{a.addRoot(t,{data:h[t]||"",attributes:(null==f?void 0:f[t])||{},isUndoable:!0})}))},k=t=>{t.forEach((t=>{a.detachRoot(t,!0)}))},O=()=>{a.data.set(h,{suppressErrorInCollaboration:!0})},D=(t,e)=>{e.forEach((e=>{Object.keys(f[e]).forEach((t=>{a.registerRootAttribute(t)})),t.clearAttributes(a.model.document.getRoot(e)),t.setAttributes(f[e],a.model.document.getRoot(e))}))},j=(0,t.useCallback)((t=>{w.current=!0,u(t)}),[u]),S=(0,t.useCallback)((t=>{w.current=!0,y(t)}),[y]);return{editor:a,editableElements:m,toolbarElement:e().createElement(g,{editor:a}),data:h,setData:j,attributes:f,setAttributes:S}}})(),a})()));
//# sourceMappingURL=index.js.map